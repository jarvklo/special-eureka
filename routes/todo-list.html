<!doctype html>
<title>My To-Do list</title>
<script type="importmap">
  {
    "imports": {
      "mastro/reactive": "https://esm.sh/jsr/@mastrojs/mastro@0.1.3/reactive?bundle"
    }
  }
</script>

<todo-list>
  <form data-onsubmit="addTodo">
    <input
      placeholder="Enter new to-do here"
      data-bind="value=newTitle"
      data-oninput="updateNewTitle"
      >
    <button>+</button>
  </form>
  <ul data-bind="renderedTodos">
  </ul>
</todo-list>

<script type="module">
  import { computed, html, ReactiveElement, signal } from "mastro/reactive";

  customElements.define("todo-list", class extends ReactiveElement {
    newTitle = signal("");
    todos = signal([]);

    renderedTodos = computed(() =>
      this.todos().map((todo, i) => html`
        <li>
          <input
            type="checkbox"
            ${todo.done ? "checked" : ""}
            data-onchange='toggleTodo(${i})'
            >
          ${todo.title}
        </li>
      `)
    );

    toggleTodo (i, e) {
      const todos = [...this.todos()];
      todos[i].done = e.target.checked;
      this.todos.set(todos);
    }

    updateNewTitle (e) {
      this.newTitle.set(e.target.value);
    }

    addTodo (e) {
      e.preventDefault();
      if (this.newTitle()) {
        this.todos.set([
          { title: this.newTitle(), done: false },
          ...this.todos(),
        ]);
        this.newTitle.set("");
      }
    }
  });
</script>